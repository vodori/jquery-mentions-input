(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.Mentions=f()}})(function(){var define,module,exports;return function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r}()({1:[function(require,module,exports){const _=require("underscore");(function($,_,undefined){var KEY={BACKSPACE:8,TAB:9,RETURN:13,ESC:27,LEFT:37,UP:38,RIGHT:39,DOWN:40,COMMA:188,SPACE:32,HOME:36,END:35};var defaultSettings={triggerChar:"@",onDataRequest:$.noop,minChars:2,allowRepeat:false,showAvatars:true,elastic:true,onCaret:false,classes:{autoCompleteItemActive:"active"},templates:{wrapper:_.template('<div class="mentions-input-box"></div>'),autocompleteList:_.template('<div class="mentions-autocomplete-list"></div>'),autocompleteListItem:_.template('<li data-ref-id="<%= id %>" data-ref-type="<%= type %>" data-display="<%= display %>"><%= content %></li>'),autocompleteListItemAvatar:_.template('<img src="<%= avatar %>" />'),autocompleteListItemIcon:_.template('<div class="icon <%= icon %>"></div>'),mentionsOverlay:_.template('<div class="mentions"><div></div></div>'),mentionItemSyntax:_.template("@[<%= value %>](<%= type %>:<%= id %>)"),mentionItemHighlight:_.template("<strong><span><%= value %></span></strong>")}};var utils={htmlEncode:function(str){return _.escape(str)},regexpEncode:function(str){return str.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1")},highlightTerm:function(value,term){if(!term&&!term.length){return value}return value.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+term+")(?![^<>]*>)(?![^&;]+;)","gi"),"<b>$1</b>")},setCaretPosition:function(domNode,caretPos){if(domNode.createTextRange){var range=domNode.createTextRange();range.move("character",caretPos);range.select()}else{if(domNode.selectionStart){domNode.focus();domNode.setSelectionRange(caretPos,caretPos)}else{domNode.focus()}}},rtrim:function(string){return string.replace(/\s+$/,"")}};var MentionsInput=function(settings){var domInput,elmInputBox,elmInputWrapper,elmAutocompleteList,elmWrapperBox,elmMentionsOverlay,elmActiveAutoCompleteItem,mentionsCollection=[],autocompleteItemCollection={},inputBuffer=[],currentDataQuery="";settings=$.extend(true,{},defaultSettings,settings);function initTextarea(){elmInputBox=$(domInput);if(elmInputBox.attr("data-mentions-input")==="true"){return}elmInputWrapper=elmInputBox.parent();elmWrapperBox=$(settings.templates.wrapper());elmInputBox.wrapAll(elmWrapperBox);elmWrapperBox=elmInputWrapper.find("> div.mentions-input-box");elmInputBox.attr("data-mentions-input","true");elmInputBox.bind("keydown",onInputBoxKeyDown);elmInputBox.bind("keypress",onInputBoxKeyPress);elmInputBox.bind("click",onInputBoxClick);elmInputBox.bind("blur",onInputBoxBlur);if(navigator.userAgent.indexOf("MSIE 8")>-1){elmInputBox.bind("propertychange",onInputBoxInput)}else{elmInputBox.bind("input",onInputBoxInput)}if(settings.elastic){elmInputBox.elastic()}}function initAutocomplete(){elmAutocompleteList=$(settings.templates.autocompleteList());elmAutocompleteList.appendTo(elmWrapperBox);elmAutocompleteList.delegate("li","mousedown",onAutoCompleteItemClick)}function initMentionsOverlay(){elmMentionsOverlay=$(settings.templates.mentionsOverlay());elmMentionsOverlay.prependTo(elmWrapperBox)}function updateValues(){var syntaxMessage=getInputBoxValue();_.each(mentionsCollection,function(mention){var textSyntax=settings.templates.mentionItemSyntax(mention);syntaxMessage=syntaxMessage.replace(new RegExp(utils.regexpEncode(mention.value),"g"),textSyntax)});var mentionText=utils.htmlEncode(syntaxMessage);_.each(mentionsCollection,function(mention){var formattedMention=_.extend({},mention,{value:utils.htmlEncode(mention.value)});var textSyntax=settings.templates.mentionItemSyntax(formattedMention);var textHighlight=settings.templates.mentionItemHighlight(formattedMention);mentionText=mentionText.replace(new RegExp(utils.regexpEncode(textSyntax),"g"),textHighlight)});mentionText=mentionText.replace(/\n/g,"<br />");mentionText=mentionText.replace(/ {2}/g,"&nbsp; ");elmInputBox.data("messageText",syntaxMessage);elmInputBox.trigger("updated");elmMentionsOverlay.find("div").html(mentionText)}function resetBuffer(){inputBuffer=[]}function updateMentionsCollection(){var inputText=getInputBoxValue();var caretPosition=elmInputBox[0].selectionStart;var didNotFindExactMatch=true;var startCaretPosition=0;var endCaretPosition=0;mentionsCollection=_.reject(mentionsCollection,function(mention,index){var mentionCantBeFound=!mention.value||inputText.indexOf(mention.value)==-1;if(mentionCantBeFound){var modifiedMentionValue=mention.value.substr(0,mention.value.length-1);var regex=new RegExp("\\"+modifiedMentionValue,"gi");regex.exec(inputText);var regexMatchIndex=regex.lastIndex;if(regexMatchIndex>0){while(caretPosition!=regexMatchIndex&&regex.exec(inputText)){regexMatchIndex=regex.lastIndex}if(caretPosition==regexMatchIndex){didNotFindExactMatch=false}startCaretPosition=regexMatchIndex-modifiedMentionValue.length;endCaretPosition=regexMatchIndex}if(didNotFindExactMatch){modifiedMentionValue=mention.value.substr(1,mention.value.length);regex=new RegExp("\\"+modifiedMentionValue,"gi");regex.exec(inputText);regexMatchIndex=regex.lastIndex-modifiedMentionValue.length;if(regexMatchIndex>=0){while(caretPosition!=regexMatchIndex&&regex.exec(inputText)){regexMatchIndex=regex.lastIndex}if(caretPosition==regexMatchIndex){didNotFindExactMatch=false}startCaretPosition=regexMatchIndex;endCaretPosition=regexMatchIndex+modifiedMentionValue.length}}if(didNotFindExactMatch){console.log("Something went wrong, couldnt find an exact match to remove for "+mention.value+". Returning early");return}var start=inputText.substr(0,startCaretPosition);var end=inputText.substr(endCaretPosition,inputText.length);var updatedMessageText=start+end;elmInputBox.val(updatedMessageText);elmInputBox.trigger("mention");utils.setCaretPosition(elmInputBox[0],start.length)}return mentionCantBeFound});mentionsCollection=_.compact(mentionsCollection);updateValues()}function addMention(mention){var currentMessage=getInputBoxValue();var regex=new RegExp("\\"+settings.triggerChar+currentDataQuery,"gi");regex.exec(currentMessage);var caretPosition=elmInputBox[0].selectionStart;var regexMatchStart=regex.lastIndex;while(caretPosition!=regexMatchStart&&regex.exec(currentMessage)){caretPosition=elmInputBox[0].selectionStart;regexMatchStart=regex.lastIndex}var startCaretPosition=regex.lastIndex-currentDataQuery.length-1;var currentCaretPosition=regex.lastIndex;var start=currentMessage.substr(0,startCaretPosition);var end=currentMessage.substr(currentCaretPosition,currentMessage.length);var startEndIndex=(start+mention.value).length+1;if(!_.find(mentionsCollection,function(object){return object.id==mention.id})){mentionsCollection.push(mention)}resetBuffer();currentDataQuery="";hideAutoComplete();var updatedMessageText=start+mention.value+" "+end;elmInputBox.val(updatedMessageText);elmInputBox.trigger("mention");updateValues();elmInputBox.focus();utils.setCaretPosition(elmInputBox[0],startEndIndex)}function addInitialMention(mention){currentDataQuery=mention.id;var currentMessage=getInputBoxValue();var regex=new RegExp("\\"+settings.triggerChar+"\\[\\~"+currentDataQuery+"\\]","gi");regex.exec(currentMessage);var startCaretPosition=regex.lastIndex-currentDataQuery.length-4;var currentCaretPosition=regex.lastIndex;var start=currentMessage.substr(0,startCaretPosition);var end=currentMessage.substr(currentCaretPosition,currentMessage.length);var startEndIndex=(start+mention.value).length+1;if(!_.find(mentionsCollection,function(object){return object.id==mention.id})){mentionsCollection.push(mention)}resetBuffer();currentDataQuery="";hideAutoComplete();var updatedMessageText=start+mention.value+end;elmInputBox.val(updatedMessageText);elmInputBox.trigger("mention");updateValues();elmInputBox.focus();utils.setCaretPosition(elmInputBox[0],startEndIndex)}function getInputBoxValue(){return $.trim(elmInputBox.val())}function textareaSelectionPosition($el){var a,b,c,d,e,f,g,h,i,j,k;if(!(i=$el[0]))return;if(!$(i).is("textarea"))return;if(i.selectionEnd==null)return;g={position:"absolute",overflow:"auto",whiteSpace:"pre-wrap",wordWrap:"break-word",boxSizing:"content-box",top:0,left:-9999},h=["boxSizing","fontFamily","fontSize","fontStyle","fontVariant","fontWeight","height","letterSpacing","lineHeight","paddingBottom","paddingLeft","paddingRight","paddingTop","textDecoration","textIndent","textTransform","width","word-spacing"];for(j=0,k=h.length;j<k;j++)e=h[j],g[e]=$(i).css(e);return c=document.createElement("div"),$(c).css(g),$(i).after(c),b=document.createTextNode(i.value.substring(0,i.selectionEnd)),a=document.createTextNode(i.value.substring(i.selectionEnd)),d=document.createElement("span"),d.innerHTML="&nbsp;",c.appendChild(b),c.appendChild(d),c.appendChild(a),c.scrollTop=i.scrollTop,f=$(d).position(),$(c).remove(),f}function scrollToInput(){var elmDistanceFromTop=$(elmInputBox).offset().top;var bodyDistanceFromTop=$("body").offset().top;var distanceScrolled=$(window).scrollTop();if(distanceScrolled>elmDistanceFromTop){$(window).scrollTop(elmDistanceFromTop-bodyDistanceFromTop)}}function onAutoCompleteItemClick(e){var elmTarget=$(this);var mention=autocompleteItemCollection[elmTarget.attr("data-uid")];addMention(mention);scrollToInput();return false}function onInputBoxClick(e){resetBuffer()}function onInputBoxBlur(e){hideAutoComplete()}function onInputBoxInput(e){updateValues();updateMentionsCollection();var triggerCharIndex=_.lastIndexOf(inputBuffer,settings.triggerChar);if(triggerCharIndex>-1){currentDataQuery=inputBuffer.slice(triggerCharIndex+1).join("");currentDataQuery=utils.rtrim(currentDataQuery);_.defer(_.bind(doSearch,this,currentDataQuery))}}function onInputBoxKeyPress(e){if(e.keyCode!==KEY.BACKSPACE){var typedValue=String.fromCharCode(e.which||e.keyCode);inputBuffer.push(typedValue)}}function onInputBoxKeyDown(e){if(e.keyCode===KEY.LEFT||e.keyCode===KEY.RIGHT||e.keyCode===KEY.HOME||e.keyCode===KEY.END){_.defer(resetBuffer);if(navigator.userAgent.indexOf("MSIE 9")>-1){_.defer(updateValues)}return}if(e.keyCode===KEY.BACKSPACE){inputBuffer=inputBuffer.slice(0,-1+inputBuffer.length);return}if(!elmAutocompleteList.is(":visible")){return true}switch(e.keyCode){case KEY.UP:case KEY.DOWN:var elmCurrentAutoCompleteItem=null;if(e.keyCode===KEY.DOWN){if(elmActiveAutoCompleteItem&&elmActiveAutoCompleteItem.length){elmCurrentAutoCompleteItem=elmActiveAutoCompleteItem.next()}else{elmCurrentAutoCompleteItem=elmAutocompleteList.find("li").first()}}else{elmCurrentAutoCompleteItem=$(elmActiveAutoCompleteItem).prev()}if(elmCurrentAutoCompleteItem.length){selectAutoCompleteItem(elmCurrentAutoCompleteItem)}return false;case KEY.RETURN:case KEY.TAB:if(elmActiveAutoCompleteItem&&elmActiveAutoCompleteItem.length){elmActiveAutoCompleteItem.trigger("mousedown");return false}break}return true}function hideAutoComplete(){elmActiveAutoCompleteItem=null;elmAutocompleteList.empty().hide()}function selectAutoCompleteItem(elmItem){elmItem.addClass(settings.classes.autoCompleteItemActive);elmItem.siblings().removeClass(settings.classes.autoCompleteItemActive);elmActiveAutoCompleteItem=elmItem}function populateDropdown(query,results){elmAutocompleteList.show();if(!settings.allowRepeat){var mentionValues=_.pluck(mentionsCollection,"value");results=_.reject(results,function(item){return _.include(mentionValues,item.name)})}if(!results.length){hideAutoComplete();return}elmAutocompleteList.empty();var elmDropDownList=$("<ul>").appendTo(elmAutocompleteList).hide();_.each(results,function(item,index){var itemUid=_.uniqueId("mention_");autocompleteItemCollection[itemUid]=_.extend({},item,{value:item.name});var elmListItem=$(settings.templates.autocompleteListItem({id:utils.htmlEncode(item.id),display:utils.htmlEncode(item.name),type:utils.htmlEncode(item.type),content:utils.highlightTerm(utils.htmlEncode(item.display?item.display:item.name),query)})).attr("data-uid",itemUid);if(index===0){selectAutoCompleteItem(elmListItem)}if(settings.showAvatars){var elmIcon;if(item.avatar){elmIcon=$(settings.templates.autocompleteListItemAvatar({avatar:item.avatar}))}else{elmIcon=$(settings.templates.autocompleteListItemIcon({icon:item.icon}))}elmIcon.prependTo(elmListItem)}elmListItem=elmListItem.appendTo(elmDropDownList)});elmAutocompleteList.show();if(settings.onCaret){positionAutocomplete(elmAutocompleteList,elmInputBox)}elmDropDownList.show()}function doSearch(query){if(query&&query.length&&query.length>=settings.minChars){settings.onDataRequest.call(this,"search",query,function(responseData){populateDropdown(query,responseData)})}else{hideAutoComplete()}}function positionAutocomplete(elmAutocompleteList,elmInputBox){var position=textareaSelectionPosition(elmInputBox),lineHeight=parseInt(elmInputBox.css("line-height"),10)||18;elmAutocompleteList.css("width","15em");elmAutocompleteList.css("left",position.left);elmAutocompleteList.css("top",lineHeight+position.top)}function resetInput(){elmInputBox.val("");mentionsCollection=[];updateValues()}function getMentionsFromContent(message){var regExp=/@\[~(.*?)\]/g;var mentions=[];var match=regExp.exec(message);while(match){var userId=match[1];if(userId){var user=_.find(settings.data,function(user){return user.id==userId});if(user){var mention={id:utils.htmlEncode(user.id),value:utils.htmlEncode(user.name),type:utils.htmlEncode("contact")};mentions.push(mention)}}match=regExp.exec(message)}return mentions}return{init:function(domTarget){domInput=domTarget;initTextarea();initAutocomplete();initMentionsOverlay();resetInput();if(settings.prefillMention){addMention(settings.prefillMention)}if(settings.initialContent){elmInputBox.val(settings.initialContent);var mentions=getMentionsFromContent(settings.initialContent);mentions.forEach(function(mention){addInitialMention(mention)})}},val:function(callback){if(!_.isFunction(callback)){return}callback.call(this,mentionsCollection.length?elmInputBox.data("messageText"):getInputBoxValue())},reset:function(){resetInput()},getMentions:function(callback){if(!_.isFunction(callback)){return}callback.call(this,mentionsCollection)}}};$.fn.mentionsInput=function(method,settings){var outerArguments=arguments;if(typeof method==="object"||!method){settings=method}return this.each(function(){var instance=$.data(this,"mentionsInput")||$.data(this,"mentionsInput",new MentionsInput(settings));if(_.isFunction(instance[method])){return instance[method].apply(this,Array.prototype.slice.call(outerArguments,1))}else if(typeof method==="object"||!method){return instance.init.call(this,this)}else{$.error("Method "+method+" does not exist")}})}})(jQuery,_)},{underscore:2}],2:[function(require,module,exports){(function(){var root=this;var previousUnderscore=root._;var ArrayProto=Array.prototype,ObjProto=Object.prototype,FuncProto=Function.prototype;var push=ArrayProto.push,slice=ArrayProto.slice,toString=ObjProto.toString,hasOwnProperty=ObjProto.hasOwnProperty;var nativeIsArray=Array.isArray,nativeKeys=Object.keys,nativeBind=FuncProto.bind,nativeCreate=Object.create;var Ctor=function(){};var _=function(obj){if(obj instanceof _)return obj;if(!(this instanceof _))return new _(obj);this._wrapped=obj};if(typeof exports!=="undefined"){if(typeof module!=="undefined"&&module.exports){exports=module.exports=_}exports._=_}else{root._=_}_.VERSION="1.8.3";var optimizeCb=function(func,context,argCount){if(context===void 0)return func;switch(argCount==null?3:argCount){case 1:return function(value){return func.call(context,value)};case 2:return function(value,other){return func.call(context,value,other)};case 3:return function(value,index,collection){return func.call(context,value,index,collection)};case 4:return function(accumulator,value,index,collection){return func.call(context,accumulator,value,index,collection)}}return function(){return func.apply(context,arguments)}};var cb=function(value,context,argCount){if(value==null)return _.identity;if(_.isFunction(value))return optimizeCb(value,context,argCount);if(_.isObject(value))return _.matcher(value);return _.property(value)};_.iteratee=function(value,context){return cb(value,context,Infinity)};var createAssigner=function(keysFunc,undefinedOnly){return function(obj){var length=arguments.length;if(length<2||obj==null)return obj;for(var index=1;index<length;index++){var source=arguments[index],keys=keysFunc(source),l=keys.length;for(var i=0;i<l;i++){var key=keys[i];if(!undefinedOnly||obj[key]===void 0)obj[key]=source[key]}}return obj}};var baseCreate=function(prototype){if(!_.isObject(prototype))return{};if(nativeCreate)return nativeCreate(prototype);Ctor.prototype=prototype;var result=new Ctor;Ctor.prototype=null;return result};var property=function(key){return function(obj){return obj==null?void 0:obj[key]}};var MAX_ARRAY_INDEX=Math.pow(2,53)-1;var getLength=property("length");var isArrayLike=function(collection){var length=getLength(collection);return typeof length=="number"&&length>=0&&length<=MAX_ARRAY_INDEX};_.each=_.forEach=function(obj,iteratee,context){iteratee=optimizeCb(iteratee,context);var i,length;if(isArrayLike(obj)){for(i=0,length=obj.length;i<length;i++){iteratee(obj[i],i,obj)}}else{var keys=_.keys(obj);for(i=0,length=keys.length;i<length;i++){iteratee(obj[keys[i]],keys[i],obj)}}return obj};_.map=_.collect=function(obj,iteratee,context){iteratee=cb(iteratee,context);var keys=!isArrayLike(obj)&&_.keys(obj),length=(keys||obj).length,results=Array(length);for(var index=0;index<length;index++){var currentKey=keys?keys[index]:index;results[index]=iteratee(obj[currentKey],currentKey,obj)}return results};function createReduce(dir){function iterator(obj,iteratee,memo,keys,index,length){for(;index>=0&&index<length;index+=dir){var currentKey=keys?keys[index]:index;memo=iteratee(memo,obj[currentKey],currentKey,obj)}return memo}return function(obj,iteratee,memo,context){iteratee=optimizeCb(iteratee,context,4);var keys=!isArrayLike(obj)&&_.keys(obj),length=(keys||obj).length,index=dir>0?0:length-1;if(arguments.length<3){memo=obj[keys?keys[index]:index];index+=dir}return iterator(obj,iteratee,memo,keys,index,length)}}_.reduce=_.foldl=_.inject=createReduce(1);_.reduceRight=_.foldr=createReduce(-1);_.find=_.detect=function(obj,predicate,context){var key;if(isArrayLike(obj)){key=_.findIndex(obj,predicate,context)}else{key=_.findKey(obj,predicate,context)}if(key!==void 0&&key!==-1)return obj[key]};_.filter=_.select=function(obj,predicate,context){var results=[];predicate=cb(predicate,context);_.each(obj,function(value,index,list){if(predicate(value,index,list))results.push(value)});return results};_.reject=function(obj,predicate,context){return _.filter(obj,_.negate(cb(predicate)),context)};_.every=_.all=function(obj,predicate,context){predicate=cb(predicate,context);var keys=!isArrayLike(obj)&&_.keys(obj),length=(keys||obj).length;for(var index=0;index<length;index++){var currentKey=keys?keys[index]:index;if(!predicate(obj[currentKey],currentKey,obj))return false}return true};_.some=_.any=function(obj,predicate,context){predicate=cb(predicate,context);var keys=!isArrayLike(obj)&&_.keys(obj),length=(keys||obj).length;for(var index=0;index<length;index++){var currentKey=keys?keys[index]:index;if(predicate(obj[currentKey],currentKey,obj))return true}return false};_.contains=_.includes=_.include=function(obj,item,fromIndex,guard){if(!isArrayLike(obj))obj=_.values(obj);if(typeof fromIndex!="number"||guard)fromIndex=0;return _.indexOf(obj,item,fromIndex)>=0};_.invoke=function(obj,method){var args=slice.call(arguments,2);var isFunc=_.isFunction(method);return _.map(obj,function(value){var func=isFunc?method:value[method];return func==null?func:func.apply(value,args)})};_.pluck=function(obj,key){return _.map(obj,_.property(key))};_.where=function(obj,attrs){return _.filter(obj,_.matcher(attrs))};_.findWhere=function(obj,attrs){return _.find(obj,_.matcher(attrs))};_.max=function(obj,iteratee,context){var result=-Infinity,lastComputed=-Infinity,value,computed;if(iteratee==null&&obj!=null){obj=isArrayLike(obj)?obj:_.values(obj);for(var i=0,length=obj.length;i<length;i++){value=obj[i];if(value>result){result=value}}}else{iteratee=cb(iteratee,context);_.each(obj,function(value,index,list){computed=iteratee(value,index,list);if(computed>lastComputed||computed===-Infinity&&result===-Infinity){result=value;lastComputed=computed}})}return result};_.min=function(obj,iteratee,context){var result=Infinity,lastComputed=Infinity,value,computed;if(iteratee==null&&obj!=null){obj=isArrayLike(obj)?obj:_.values(obj);for(var i=0,length=obj.length;i<length;i++){value=obj[i];if(value<result){result=value}}}else{iteratee=cb(iteratee,context);_.each(obj,function(value,index,list){computed=iteratee(value,index,list);if(computed<lastComputed||computed===Infinity&&result===Infinity){result=value;lastComputed=computed}})}return result};_.shuffle=function(obj){var set=isArrayLike(obj)?obj:_.values(obj);var length=set.length;var shuffled=Array(length);for(var index=0,rand;index<length;index++){rand=_.random(0,index);if(rand!==index)shuffled[index]=shuffled[rand];shuffled[rand]=set[index]}return shuffled};_.sample=function(obj,n,guard){if(n==null||guard){if(!isArrayLike(obj))obj=_.values(obj);return obj[_.random(obj.length-1)]}return _.shuffle(obj).slice(0,Math.max(0,n))};_.sortBy=function(obj,iteratee,context){iteratee=cb(iteratee,context);return _.pluck(_.map(obj,function(value,index,list){return{value:value,index:index,criteria:iteratee(value,index,list)}}).sort(function(left,right){var a=left.criteria;var b=right.criteria;if(a!==b){if(a>b||a===void 0)return 1;if(a<b||b===void 0)return-1}return left.index-right.index}),"value")};var group=function(behavior){return function(obj,iteratee,context){var result={};iteratee=cb(iteratee,context);_.each(obj,function(value,index){var key=iteratee(value,index,obj);behavior(result,value,key)});return result}};_.groupBy=group(function(result,value,key){if(_.has(result,key))result[key].push(value);else result[key]=[value]});_.indexBy=group(function(result,value,key){result[key]=value});_.countBy=group(function(result,value,key){if(_.has(result,key))result[key]++;else result[key]=1});_.toArray=function(obj){if(!obj)return[];if(_.isArray(obj))return slice.call(obj);if(isArrayLike(obj))return _.map(obj,_.identity);return _.values(obj)};_.size=function(obj){if(obj==null)return 0;return isArrayLike(obj)?obj.length:_.keys(obj).length};_.partition=function(obj,predicate,context){predicate=cb(predicate,context);var pass=[],fail=[];_.each(obj,function(value,key,obj){(predicate(value,key,obj)?pass:fail).push(value)});return[pass,fail]};_.first=_.head=_.take=function(array,n,guard){if(array==null)return void 0;if(n==null||guard)return array[0];return _.initial(array,array.length-n)};_.initial=function(array,n,guard){return slice.call(array,0,Math.max(0,array.length-(n==null||guard?1:n)))};_.last=function(array,n,guard){if(array==null)return void 0;if(n==null||guard)return array[array.length-1];return _.rest(array,Math.max(0,array.length-n))};_.rest=_.tail=_.drop=function(array,n,guard){return slice.call(array,n==null||guard?1:n)};_.compact=function(array){return _.filter(array,_.identity)};var flatten=function(input,shallow,strict,startIndex){var output=[],idx=0;for(var i=startIndex||0,length=getLength(input);i<length;i++){var value=input[i];if(isArrayLike(value)&&(_.isArray(value)||_.isArguments(value))){if(!shallow)value=flatten(value,shallow,strict);var j=0,len=value.length;output.length+=len;while(j<len){output[idx++]=value[j++]}}else if(!strict){output[idx++]=value}}return output};_.flatten=function(array,shallow){return flatten(array,shallow,false)};_.without=function(array){return _.difference(array,slice.call(arguments,1))};_.uniq=_.unique=function(array,isSorted,iteratee,context){if(!_.isBoolean(isSorted)){context=iteratee;iteratee=isSorted;isSorted=false}if(iteratee!=null)iteratee=cb(iteratee,context);var result=[];var seen=[];for(var i=0,length=getLength(array);i<length;i++){var value=array[i],computed=iteratee?iteratee(value,i,array):value;if(isSorted){if(!i||seen!==computed)result.push(value);seen=computed}else if(iteratee){if(!_.contains(seen,computed)){seen.push(computed);result.push(value)}}else if(!_.contains(result,value)){result.push(value)}}return result};_.union=function(){return _.uniq(flatten(arguments,true,true))};_.intersection=function(array){var result=[];var argsLength=arguments.length;for(var i=0,length=getLength(array);i<length;i++){var item=array[i];if(_.contains(result,item))continue;for(var j=1;j<argsLength;j++){if(!_.contains(arguments[j],item))break}if(j===argsLength)result.push(item)}return result};_.difference=function(array){var rest=flatten(arguments,true,true,1);return _.filter(array,function(value){return!_.contains(rest,value)})};_.zip=function(){return _.unzip(arguments)};_.unzip=function(array){var length=array&&_.max(array,getLength).length||0;var result=Array(length);for(var index=0;index<length;index++){result[index]=_.pluck(array,index)}return result};_.object=function(list,values){var result={};for(var i=0,length=getLength(list);i<length;i++){if(values){result[list[i]]=values[i]}else{result[list[i][0]]=list[i][1]}}return result};function createPredicateIndexFinder(dir){return function(array,predicate,context){predicate=cb(predicate,context);var length=getLength(array);var index=dir>0?0:length-1;for(;index>=0&&index<length;index+=dir){if(predicate(array[index],index,array))return index}return-1}}_.findIndex=createPredicateIndexFinder(1);_.findLastIndex=createPredicateIndexFinder(-1);_.sortedIndex=function(array,obj,iteratee,context){iteratee=cb(iteratee,context,1);var value=iteratee(obj);var low=0,high=getLength(array);while(low<high){var mid=Math.floor((low+high)/2);if(iteratee(array[mid])<value)low=mid+1;else high=mid}return low};function createIndexFinder(dir,predicateFind,sortedIndex){return function(array,item,idx){var i=0,length=getLength(array);if(typeof idx=="number"){if(dir>0){i=idx>=0?idx:Math.max(idx+length,i)}else{length=idx>=0?Math.min(idx+1,length):idx+length+1}}else if(sortedIndex&&idx&&length){idx=sortedIndex(array,item);return array[idx]===item?idx:-1}if(item!==item){idx=predicateFind(slice.call(array,i,length),_.isNaN);return idx>=0?idx+i:-1}for(idx=dir>0?i:length-1;idx>=0&&idx<length;idx+=dir){if(array[idx]===item)return idx}return-1}}_.indexOf=createIndexFinder(1,_.findIndex,_.sortedIndex);_.lastIndexOf=createIndexFinder(-1,_.findLastIndex);_.range=function(start,stop,step){if(stop==null){stop=start||0;start=0}step=step||1;var length=Math.max(Math.ceil((stop-start)/step),0);var range=Array(length);for(var idx=0;idx<length;idx++,start+=step){range[idx]=start}return range};var executeBound=function(sourceFunc,boundFunc,context,callingContext,args){if(!(callingContext instanceof boundFunc))return sourceFunc.apply(context,args);var self=baseCreate(sourceFunc.prototype);var result=sourceFunc.apply(self,args);if(_.isObject(result))return result;return self};_.bind=function(func,context){if(nativeBind&&func.bind===nativeBind)return nativeBind.apply(func,slice.call(arguments,1));if(!_.isFunction(func))throw new TypeError("Bind must be called on a function");var args=slice.call(arguments,2);var bound=function(){return executeBound(func,bound,context,this,args.concat(slice.call(arguments)))};return bound};_.partial=function(func){var boundArgs=slice.call(arguments,1);var bound=function(){var position=0,length=boundArgs.length;var args=Array(length);for(var i=0;i<length;i++){args[i]=boundArgs[i]===_?arguments[position++]:boundArgs[i]}while(position<arguments.length)args.push(arguments[position++]);return executeBound(func,bound,this,this,args)};return bound};_.bindAll=function(obj){var i,length=arguments.length,key;if(length<=1)throw new Error("bindAll must be passed function names");for(i=1;i<length;i++){key=arguments[i];obj[key]=_.bind(obj[key],obj)}return obj};_.memoize=function(func,hasher){var memoize=function(key){var cache=memoize.cache;var address=""+(hasher?hasher.apply(this,arguments):key);if(!_.has(cache,address))cache[address]=func.apply(this,arguments);return cache[address]};memoize.cache={};return memoize};_.delay=function(func,wait){var args=slice.call(arguments,2);return setTimeout(function(){return func.apply(null,args)},wait)};_.defer=_.partial(_.delay,_,1);_.throttle=function(func,wait,options){var context,args,result;var timeout=null;var previous=0;if(!options)options={};var later=function(){previous=options.leading===false?0:_.now();timeout=null;result=func.apply(context,args);if(!timeout)context=args=null};return function(){var now=_.now();if(!previous&&options.leading===false)previous=now;var remaining=wait-(now-previous);context=this;args=arguments;if(remaining<=0||remaining>wait){if(timeout){clearTimeout(timeout);timeout=null}previous=now;result=func.apply(context,args);if(!timeout)context=args=null}else if(!timeout&&options.trailing!==false){timeout=setTimeout(later,remaining)}return result}};_.debounce=function(func,wait,immediate){var timeout,args,context,timestamp,result;var later=function(){var last=_.now()-timestamp;if(last<wait&&last>=0){timeout=setTimeout(later,wait-last)}else{timeout=null;if(!immediate){result=func.apply(context,args);if(!timeout)context=args=null}}};return function(){context=this;args=arguments;timestamp=_.now();var callNow=immediate&&!timeout;if(!timeout)timeout=setTimeout(later,wait);if(callNow){result=func.apply(context,args);context=args=null}return result}};_.wrap=function(func,wrapper){return _.partial(wrapper,func)};_.negate=function(predicate){return function(){return!predicate.apply(this,arguments)}};_.compose=function(){var args=arguments;var start=args.length-1;return function(){var i=start;var result=args[start].apply(this,arguments);while(i--)result=args[i].call(this,result);return result}};_.after=function(times,func){return function(){if(--times<1){return func.apply(this,arguments)}}};_.before=function(times,func){var memo;return function(){if(--times>0){memo=func.apply(this,arguments)}if(times<=1)func=null;return memo}};_.once=_.partial(_.before,2);var hasEnumBug=!{toString:null}.propertyIsEnumerable("toString");var nonEnumerableProps=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];function collectNonEnumProps(obj,keys){var nonEnumIdx=nonEnumerableProps.length;var constructor=obj.constructor;var proto=_.isFunction(constructor)&&constructor.prototype||ObjProto;var prop="constructor";if(_.has(obj,prop)&&!_.contains(keys,prop))keys.push(prop);while(nonEnumIdx--){prop=nonEnumerableProps[nonEnumIdx];if(prop in obj&&obj[prop]!==proto[prop]&&!_.contains(keys,prop)){keys.push(prop)}}}_.keys=function(obj){if(!_.isObject(obj))return[];if(nativeKeys)return nativeKeys(obj);var keys=[];for(var key in obj)if(_.has(obj,key))keys.push(key);if(hasEnumBug)collectNonEnumProps(obj,keys);return keys};_.allKeys=function(obj){if(!_.isObject(obj))return[];var keys=[];for(var key in obj)keys.push(key);if(hasEnumBug)collectNonEnumProps(obj,keys);return keys};_.values=function(obj){var keys=_.keys(obj);var length=keys.length;var values=Array(length);for(var i=0;i<length;i++){values[i]=obj[keys[i]]}return values};_.mapObject=function(obj,iteratee,context){iteratee=cb(iteratee,context);var keys=_.keys(obj),length=keys.length,results={},currentKey;for(var index=0;index<length;index++){
currentKey=keys[index];results[currentKey]=iteratee(obj[currentKey],currentKey,obj)}return results};_.pairs=function(obj){var keys=_.keys(obj);var length=keys.length;var pairs=Array(length);for(var i=0;i<length;i++){pairs[i]=[keys[i],obj[keys[i]]]}return pairs};_.invert=function(obj){var result={};var keys=_.keys(obj);for(var i=0,length=keys.length;i<length;i++){result[obj[keys[i]]]=keys[i]}return result};_.functions=_.methods=function(obj){var names=[];for(var key in obj){if(_.isFunction(obj[key]))names.push(key)}return names.sort()};_.extend=createAssigner(_.allKeys);_.extendOwn=_.assign=createAssigner(_.keys);_.findKey=function(obj,predicate,context){predicate=cb(predicate,context);var keys=_.keys(obj),key;for(var i=0,length=keys.length;i<length;i++){key=keys[i];if(predicate(obj[key],key,obj))return key}};_.pick=function(object,oiteratee,context){var result={},obj=object,iteratee,keys;if(obj==null)return result;if(_.isFunction(oiteratee)){keys=_.allKeys(obj);iteratee=optimizeCb(oiteratee,context)}else{keys=flatten(arguments,false,false,1);iteratee=function(value,key,obj){return key in obj};obj=Object(obj)}for(var i=0,length=keys.length;i<length;i++){var key=keys[i];var value=obj[key];if(iteratee(value,key,obj))result[key]=value}return result};_.omit=function(obj,iteratee,context){if(_.isFunction(iteratee)){iteratee=_.negate(iteratee)}else{var keys=_.map(flatten(arguments,false,false,1),String);iteratee=function(value,key){return!_.contains(keys,key)}}return _.pick(obj,iteratee,context)};_.defaults=createAssigner(_.allKeys,true);_.create=function(prototype,props){var result=baseCreate(prototype);if(props)_.extendOwn(result,props);return result};_.clone=function(obj){if(!_.isObject(obj))return obj;return _.isArray(obj)?obj.slice():_.extend({},obj)};_.tap=function(obj,interceptor){interceptor(obj);return obj};_.isMatch=function(object,attrs){var keys=_.keys(attrs),length=keys.length;if(object==null)return!length;var obj=Object(object);for(var i=0;i<length;i++){var key=keys[i];if(attrs[key]!==obj[key]||!(key in obj))return false}return true};var eq=function(a,b,aStack,bStack){if(a===b)return a!==0||1/a===1/b;if(a==null||b==null)return a===b;if(a instanceof _)a=a._wrapped;if(b instanceof _)b=b._wrapped;var className=toString.call(a);if(className!==toString.call(b))return false;switch(className){case"[object RegExp]":case"[object String]":return""+a===""+b;case"[object Number]":if(+a!==+a)return+b!==+b;return+a===0?1/+a===1/b:+a===+b;case"[object Date]":case"[object Boolean]":return+a===+b}var areArrays=className==="[object Array]";if(!areArrays){if(typeof a!="object"||typeof b!="object")return false;var aCtor=a.constructor,bCtor=b.constructor;if(aCtor!==bCtor&&!(_.isFunction(aCtor)&&aCtor instanceof aCtor&&_.isFunction(bCtor)&&bCtor instanceof bCtor)&&("constructor"in a&&"constructor"in b)){return false}}aStack=aStack||[];bStack=bStack||[];var length=aStack.length;while(length--){if(aStack[length]===a)return bStack[length]===b}aStack.push(a);bStack.push(b);if(areArrays){length=a.length;if(length!==b.length)return false;while(length--){if(!eq(a[length],b[length],aStack,bStack))return false}}else{var keys=_.keys(a),key;length=keys.length;if(_.keys(b).length!==length)return false;while(length--){key=keys[length];if(!(_.has(b,key)&&eq(a[key],b[key],aStack,bStack)))return false}}aStack.pop();bStack.pop();return true};_.isEqual=function(a,b){return eq(a,b)};_.isEmpty=function(obj){if(obj==null)return true;if(isArrayLike(obj)&&(_.isArray(obj)||_.isString(obj)||_.isArguments(obj)))return obj.length===0;return _.keys(obj).length===0};_.isElement=function(obj){return!!(obj&&obj.nodeType===1)};_.isArray=nativeIsArray||function(obj){return toString.call(obj)==="[object Array]"};_.isObject=function(obj){var type=typeof obj;return type==="function"||type==="object"&&!!obj};_.each(["Arguments","Function","String","Number","Date","RegExp","Error"],function(name){_["is"+name]=function(obj){return toString.call(obj)==="[object "+name+"]"}});if(!_.isArguments(arguments)){_.isArguments=function(obj){return _.has(obj,"callee")}}if(typeof/./!="function"&&typeof Int8Array!="object"){_.isFunction=function(obj){return typeof obj=="function"||false}}_.isFinite=function(obj){return isFinite(obj)&&!isNaN(parseFloat(obj))};_.isNaN=function(obj){return _.isNumber(obj)&&obj!==+obj};_.isBoolean=function(obj){return obj===true||obj===false||toString.call(obj)==="[object Boolean]"};_.isNull=function(obj){return obj===null};_.isUndefined=function(obj){return obj===void 0};_.has=function(obj,key){return obj!=null&&hasOwnProperty.call(obj,key)};_.noConflict=function(){root._=previousUnderscore;return this};_.identity=function(value){return value};_.constant=function(value){return function(){return value}};_.noop=function(){};_.property=property;_.propertyOf=function(obj){return obj==null?function(){}:function(key){return obj[key]}};_.matcher=_.matches=function(attrs){attrs=_.extendOwn({},attrs);return function(obj){return _.isMatch(obj,attrs)}};_.times=function(n,iteratee,context){var accum=Array(Math.max(0,n));iteratee=optimizeCb(iteratee,context,1);for(var i=0;i<n;i++)accum[i]=iteratee(i);return accum};_.random=function(min,max){if(max==null){max=min;min=0}return min+Math.floor(Math.random()*(max-min+1))};_.now=Date.now||function(){return(new Date).getTime()};var escapeMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"};var unescapeMap=_.invert(escapeMap);var createEscaper=function(map){var escaper=function(match){return map[match]};var source="(?:"+_.keys(map).join("|")+")";var testRegexp=RegExp(source);var replaceRegexp=RegExp(source,"g");return function(string){string=string==null?"":""+string;return testRegexp.test(string)?string.replace(replaceRegexp,escaper):string}};_.escape=createEscaper(escapeMap);_.unescape=createEscaper(unescapeMap);_.result=function(object,property,fallback){var value=object==null?void 0:object[property];if(value===void 0){value=fallback}return _.isFunction(value)?value.call(object):value};var idCounter=0;_.uniqueId=function(prefix){var id=++idCounter+"";return prefix?prefix+id:id};_.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var noMatch=/(.)^/;var escapes={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"};var escaper=/\\|'|\r|\n|\u2028|\u2029/g;var escapeChar=function(match){return"\\"+escapes[match]};_.template=function(text,settings,oldSettings){if(!settings&&oldSettings)settings=oldSettings;settings=_.defaults({},settings,_.templateSettings);var matcher=RegExp([(settings.escape||noMatch).source,(settings.interpolate||noMatch).source,(settings.evaluate||noMatch).source].join("|")+"|$","g");var index=0;var source="__p+='";text.replace(matcher,function(match,escape,interpolate,evaluate,offset){source+=text.slice(index,offset).replace(escaper,escapeChar);index=offset+match.length;if(escape){source+="'+\n((__t=("+escape+"))==null?'':_.escape(__t))+\n'"}else if(interpolate){source+="'+\n((__t=("+interpolate+"))==null?'':__t)+\n'"}else if(evaluate){source+="';\n"+evaluate+"\n__p+='"}return match});source+="';\n";if(!settings.variable)source="with(obj||{}){\n"+source+"}\n";source="var __t,__p='',__j=Array.prototype.join,"+"print=function(){__p+=__j.call(arguments,'');};\n"+source+"return __p;\n";try{var render=new Function(settings.variable||"obj","_",source)}catch(e){e.source=source;throw e}var template=function(data){return render.call(this,data,_)};var argument=settings.variable||"obj";template.source="function("+argument+"){\n"+source+"}";return template};_.chain=function(obj){var instance=_(obj);instance._chain=true;return instance};var result=function(instance,obj){return instance._chain?_(obj).chain():obj};_.mixin=function(obj){_.each(_.functions(obj),function(name){var func=_[name]=obj[name];_.prototype[name]=function(){var args=[this._wrapped];push.apply(args,arguments);return result(this,func.apply(_,args))}})};_.mixin(_);_.each(["pop","push","reverse","shift","sort","splice","unshift"],function(name){var method=ArrayProto[name];_.prototype[name]=function(){var obj=this._wrapped;method.apply(obj,arguments);if((name==="shift"||name==="splice")&&obj.length===0)delete obj[0];return result(this,obj)}});_.each(["concat","join","slice"],function(name){var method=ArrayProto[name];_.prototype[name]=function(){return result(this,method.apply(this._wrapped,arguments))}});_.prototype.value=function(){return this._wrapped};_.prototype.valueOf=_.prototype.toJSON=_.prototype.value;_.prototype.toString=function(){return""+this._wrapped};if(typeof define==="function"&&define.amd){define("underscore",[],function(){return _})}}).call(this)},{}]},{},[1])(1)});
